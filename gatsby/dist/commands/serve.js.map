{"version":3,"sources":["../../src/commands/serve.js"],"names":["openurl","require","signalExit","compression","express","module","exports","program","port","open","parseInt","app","use","static","req","res","next","accepts","status","sendFile","root","server","listen","openUrlString","console","log","code","signal","close"],"mappings":";;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,KAAF,CAAvB;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAE,aAAF,CAA1B;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAE,aAAF,CAA3B;;AACA,MAAMG,OAAO,GAAGH,OAAO,CAAE,SAAF,CAAvB;;AAEAI,MAAM,CAACC,OAAP,GAAiBC,OAAO,IAAI;AAAA,MACpBC,IADoB,GACLD,OADK,CACpBC,IADoB;AAAA,MACdC,IADc,GACLF,OADK,CACdE,IADc;AAE1BD,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAiB,QAAjB,GAA2BE,QAAQ,CAACF,IAAD,EAAO,EAAP,CAAnC,GAAgDA,IAAvD;AAEA,QAAMG,GAAG,GAAGP,OAAO,EAAnB;AACAO,EAAAA,GAAG,CAACC,GAAJ,CAAQT,WAAW,EAAnB;AACAQ,EAAAA,GAAG,CAACC,GAAJ,CAAQR,OAAO,CAACS,MAAR,CAAgB,QAAhB,CAAR;AACAF,EAAAA,GAAG,CAACC,GAAJ,CAAQ,CAACE,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC1B,QAAIF,GAAG,CAACG,OAAJ,CAAa,MAAb,CAAJ,EAAyB;AACvBF,MAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,QAAhB,CAA0B,UAA1B,EAAqC;AAAEC,QAAAA,IAAI,EAAG;AAAT,OAArC;AACD,KAFD,MAEO;AACLJ,MAAAA,IAAI;AACL;AACF,GAND;AAQA,QAAMK,MAAM,GAAGV,GAAG,CAACW,MAAJ,CAAWd,IAAX,EAAiB,MAAM;AACpC,QAAIe,aAAa,GAAI,mBAAD,GAAsBf,IAA1C;AACAgB,IAAAA,OAAO,CAACC,GAAR,CAAa,0BAAb,EAAwCF,aAAxC;;AACA,QAAId,IAAJ,EAAU;AACR,UAAIc,aAAa,GAAI,mBAAD,GAAsBf,IAA1C;AACAgB,MAAAA,OAAO,CAACC,GAAR,CAAa,oBAAb;AACAzB,MAAAA,OAAO,CAACuB,aAAD,CAAP;AACD;AACF,GARc,CAAf;AAUArB,EAAAA,UAAU,CAAC,CAACwB,IAAD,EAAOC,MAAP,KAAkB;AAC3BN,IAAAA,MAAM,CAACO,KAAP;AACD,GAFS,CAAV;AAGD,CA5BD","sourcesContent":["/* @flow weak */\nconst openurl = require(`opn`)\nconst signalExit = require(`signal-exit`)\nconst compression = require(`compression`)\nconst express = require(`express`)\n\nmodule.exports = program => {\n  let { port, open } = program\n  port = typeof port === `string` ? parseInt(port, 10) : port\n\n  const app = express()\n  app.use(compression())\n  app.use(express.static(`public`))\n  app.use((req, res, next) => {\n    if (req.accepts(`html`)) {\n      res.status(404).sendFile(`404.html`, { root: `public` })\n    } else {\n      next()\n    }\n  })\n\n  const server = app.listen(port, () => {\n    let openUrlString = `http://localhost:` + port\n    console.log(`gatsby serve running at:`, openUrlString)\n    if (open) {\n      let openUrlString = `http://localhost:` + port\n      console.log(`Opening browser...`)\n      openurl(openUrlString)\n    }\n  })\n\n  signalExit((code, signal) => {\n    server.close()\n  })\n}\n"],"file":"serve.js"}